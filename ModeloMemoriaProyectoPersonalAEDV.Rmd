---
title: "Transformaciones del mercado laboral europeo: teletrabajo y emprendimiento en el siglo XXI"
author: "Lucas Mendoza Rodríguez"
date: "`r Sys.Date()`"
output:
  html_document:
    css: estilos.css
    number_sections: true
---

<!--
# TRUCOS ÚTILES AL EDITAR UN FICHERO Rmarkdown: 
(1) TECLAS: CTRL-MAY-1 : EDICIÓN DE CÓDIGO OCUPA/NO OCUPA TODA LA VENTANA
(2) TECLAS: CTRL-ALT-C : EJECUTA UN CHUNK CUANDO EL CURSOR DEL RATÓN ESTA DENTRO DEL CHUNK (OTRA FORMA ES HACER CLICK EN EL BOTÓN TRIANGULAR VERDE EN LA ESQUINA SUPERIOR DERECHA DEL CHUNK)
(3) ACTIVAR "knit on Save" PARA COMPILAR AUTOMÁTICAMENTE AL GUARDAR EL ARCHIVO (CTRL-S)
PARA CREAR UN CHUNK NUEVO USAR BOTÓN VERDE CON UNA "C" EN LA PARTE SUPERIOR DERECHA DE LA VENTANA
(4) PARA EJECUTAR UNA PORCIÓN DE CÓDIGO O VISUALIZAR EL VALOR DE UNA TABLA/VARIABLE SELECCIONAR EL CÓDIGO CON EL RATÓN Y HACER CTRL-ENTER -->

<!-- Opcionalmente, el formateo de este documento en HTML se puede mejorar usando CSS --> 

```{r,echo=FALSE}
# OPCIONES POR DEFECTO AL COMPILAR LOS CHUNKS 
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  cache=FALSE, # ponerlo a TRUE acelera la compilación pues solo recompila los chunks modificados. Es útil al escribir texto con mucho código que tarda tiempo en compilar. Puede fallar cuando unos chunks dependen de otros. En ese caso, o cuando hay errores que no entiendes, borra la carpeta auxiliar que se genera con la extensión "_cache" para obligar a recompilar todo. 
  echo=FALSE
)
```

```{r global, include=FALSE}
# carga de librerías
library(DT)
library(googlesheets4)
library(kableExtra)
library(patchwork)
library(zoo)
library(MASS)
library(flexdashboard)
library(datasets)
library(highcharter) 
library(fpp3)
library(RColorBrewer)
library(openxlsx)  
library(leaflet)  
library(geojsonio)
library(plotly)
library(ggplot2)
library(tidyverse)
```

```{r,echo=FALSE}
# asociamos funciones a determinadas librerías para evitar posibles errores 
filter <- dplyr::filter # Filtra filas según condiciones
select <- dplyr::select # Selecciona columnas
mutate <- dplyr::mutate # Crea o modifica columnas
arrange <- dplyr::arrange # Ordena filas
group_by <- dplyr::group_by # Agrupa datos
summarise <- dplyr::summarise # Resume variables (por ejemplo, con medias, conteos)
summarize <- dplyr::summarize # Lo mismo que summarise
rename <- dplyr::rename # Cambia nombres de columnas
distinct <- dplyr::distinct # Elimina filas duplicadas
slice<- dplyr::slice # Selecciona filas por posición
relocate<- dplyr::relocate # Reordena columnas

selectInput <- shiny::selectInput
```


<!-- Todos los proyectos personales tienen que tener un cuadro de mandos (Tema 7 de la asignatura) cuya dirección es similar a la que sigue poniendo tu nº de usuario (en lugar de a2405) y el nombre del Rmd asociado. Los cuadros de mando se alojan en un servidor del DIS y solo se puede acceder a ellos a través de la red de la ULPGC o usando VPN -->

[Cuadro de mandos](http://10.22.143.222:3838/sample-apps/a2405/Dashboard3.Rmd)


<!-- Añadir imagen ilustrativa del tema de mi proyecto --> 
<center>
<img src="foto_portada2.jpg" width="60%" />
</center>

# Introducción


<!-- situar el tema en un contexto amplio, destacando su relevancia en la actualidad. Delimitar el problema que se aborda en ese contexto amplio --> 
## La Movilidad Laboral en la Europa Contemporánea: entre la Eficiencia Económica y la Sostenibilidad Territorial

### Contexto Geoeconómico Actual
En la Europa del siglo XXI, cómo y dónde se desplaza la gente para ir a trabajar es un tema muy importante. Este fenómeno, llamado "commuting" o movilidad laboral, nos dice mucho sobre la economía y la cohesión social del continente. Se refiere específicamente al trayecto regular que una persona realiza entre su lugar de residencia y su lugar de trabajo o estudio. La creciente fragmentación espacial entre lugares de residencia y trabajo representa una transformación estructural profundamente influenciada por políticas de integración europea y la reconfiguración de los mercados laborales regionales.

### La Paradoja del Commuting Moderno
Nos enfrentamos a una paradoja fundamental: mientras la movilidad laboral es esencial para la optimización económica y una concordancia eficiente entre talento y empleo, su crecimiento exponencial genera graves problemas que amenazan la sostenibilidad del modelo europeo:

Desequilibrios territoriales crecientes entre regiones receptoras y emisoras de trabajadores

Presión insostenible sobre infraestructuras de transporte y sistemas medioambientales

Costes humanos en calidad de vida, salud y cohesión familiar

Brechas de productividad entre centros económicos y periferias

### Relevancia en la Agenda Europea Actual
Este problema se sitúa en el corazón de debates cruciales:

Crisis de Vivienda y Asequibilidad: el commuting como respuesta adaptativa a la imposibilidad de residir cerca de los centros de empleo cualificado.

Transición Ecológica: los desplazamientos laborales representan aproximadamente el 25% de las emisiones de transporte en la UE, convirtiéndose en un obstáculo crítico para los objetivos del Pacto Verde Europeo.

Desigualdad entre Regiones: Muestra que hay zonas muy ricas en empleo y otras que funcionan principalmente como "ciudades dormitorio".

Transformación Digital y Teletrabajo: La pandemia aceleró tendencias que podrían reconfigurar permanentemente los patrones de movilidad, creando nuevas oportunidades y riesgos para las regiones periféricas.

### El Problema de Investigación
En este contexto, comprender los volúmenes de movilidad y las distancias recorridas se convierte en una necesidad estratégica. Nos encontramos ante la falta de análisis integrados que combinen patrones espaciales de movilidad (origen-destino), características sociodemográficas de los trabajadores, tipologías de empleo y sectores económicos y distancias y tiempos reales de desplazamiento


### Importancia del Análisis a Nivel NUTS 2
La escala regional NUTS 2 representa la unidad óptima para este análisis, ya que corresponde al nivel donde se diseñan e implementan las políticas regionales europeas, permitiendo diseñar estrategias de planificación territorial coordinada, optimizar inversiones en infraestructuras de transporte  y desarrollar políticas de vivienda y desarrollo económico integradas.

La movilidad laboral ya no puede analizarse como un fenómeno aislado, sino como el sistema circulatorio de la economía europea integrada, cuya salud determina en gran medida la competitividad, sostenibilidad y equidad del proyecto común europeo en las próximas décadas.


## Justificación de la Ampliación de Fuentes: Integración de otro dataset (lfst_r_lfe2emprtn)

### Limitaciones del Dataset Principal
Si bien lfst_r_lfe2ecomm proporciona los flujos absolutos de movilidad laboral, presenta una limitación crítica: no contextualiza estos flujos dentro del mercado laboral regional total. Esta carencia impide:

Calcular proporciones significativas respecto a la población empleada total

Comparar regiones de diferente tamaño demográfico y económico

Analizar intensidades relativas de movilidad entre territorios


### Valor Añadido del nuevo dataset
La integración del dataset lfst_r_lfe2emprtn (Employment by region and commuting patterns) resuelve estas limitaciones al proporcionar:

1. Tasas de Commuting Relativas:

Proporción de trabajadores que commutan respecto al total de empleados

Porcentajes de población que trabaja en su región de residencia vs. fuera de ella

2. Contextualización Demográfica:

Tamaño de la base de empleo total en cada región NUTS 2

Capacidad para calcular indicadores de intensidad de movilidad

3. Análisis de Dependencia Funcional:

Identificación de regiones "dormitorio" con alta dependencia laboral externa

Detección de polos de atracción laboral regional

4. Comparabilidad Territorial Efectiva:

Métricas estandarizadas que permiten comparar regiones de diferente tamaño

Indicadores normalizados para análisis temporales consistentes



##  Estado actual

<!-- Explicar conceptos claves relacionados con el tema que se aborda. Comentar estudios/resultados precedentes. Identificación de elementos/circunstancias que justifican la realización del estudio sobre este tema. Relevancia y oportunidad de abordar el tema.-->
### Conceptos Fundamentales
La movilidad laboral o commuting representa los desplazamientos regulares entre residencia y trabajo, configurando regiones funcionales del mercado laboral donde las interacciones económicas superan los límites administrativos. Este fenómeno evidencia la policentricidad territorial de la UE, donde múltiples núcleos urbanos mantienen relaciones de interdependencia, generando distintos grados de dependencia laboral entre regiones.


### Justificación del Estudio
Transformaciones críticas actuales exigen nueva investigación:

Crisis de vivienda: Los precios en centros urbanos han aumentado un 35%, convirtiendo el commuting en estrategia forzada para acceder a empleo cualificado.

Transición ecológica: Los desplazamientos laborales contribuyen significativamente al 25% de emisiones del transporte UE.

Reconfiguración post-pandemia: Modelos híbridos de trabajo redistribuyen patrones de movilidad establecidos durante décadas.

Especialización regional acelerada: Concentración de sectores high-tech en clusters específicos aumenta la necesidad de movilidad laboral cualificada.

### Relevancia y Oportunidad
Este estudio aborda necesidades urgentes de planificación territorial identificando corredores de movilidad prioritarios y optimizando inversiones en transporte sostenible. Contribuye a la cohesión territorial detectando regiones en riesgo de exclusión funcional y mejorando la efectividad de los fondos de cohesión.

La oportunidad temporal es única: contamos con datos post-pandemia suficientes (2021-2023) y coincidimos con el ciclo de implementación de fondos europeos 2021-2027. El contexto político favorece la investigación, con el Pacto Verde Europeo priorizando movilidad sostenible y NextGenerationEU impulsando transformación digital.

La investigación proporciona herramientas para construir sistemas de movilidad más resilientes, anticipando cambios estructurales y diseñando políticas adaptativas para futuras crisis, situándose en la intersección de agendas críticas para el futuro de la UE.


## Motivación

<!-- Descripción de la motivación que te ha llevado a elegir este tema de trabajo que puede incluir intereses personales/sociales/profesionales --> 
Como estudiante de Ingeniería de Datos, este tema me permite aplicar técnicas avanzadas con datos reales de Eurostat. Es un proyecto donde puedo trabajar con datos espaciales complejos y crear visualizaciones que muestren patrones territoriales.

Me interesa personalmente porque afecta la vida diaria de millones de personas. Veo cómo los largos desplazamientos al trabajo impactan en la calidad de vida y el medio ambiente. Quiero entender estas dinámicas para contribuir a mejores políticas públicas.

Profesionalmente, este trabajo conecta con áreas en crecimiento como el análisis de datos espaciales y la ciencia de datos para el bien social. Como futuro ingeniero de datos, busco proyectos donde la técnica sirva a un propósito social claro, y este es un ejemplo perfecto.

## Objetivos

<!-- Expresa de forma amplia y global el propósito principal del trabajo. Cuales son sus metas principales -->
### Propósito Principal
El propósito fundamental de este trabajo es entender no solo cuánta gente se mueve, sino también quiénes son (edad, sector de trabajo, etc.), de dónde a dónde se desplazan y qué distancias recorren. Esto nos ayudará a tomar mejores decisiones para planificar el territorio y el transporte. Otras metas a destacar son:

1. Comprensión Integral de los Flujos Laborales
Identificar corredores principales de movilidad y regiones con alta interdependencia laboral

Analizar cómo factores como la educación, sector laboral y tipo de contrato influyen en los patrones de desplazamiento

2. Desarrollo de Herramientas de Análisis
Desarrollar visualizaciones claras y efectivas que comuniquen patrones complejos

Implementar métodos de análisis espacial que revelen relaciones territoriales no evidentes

3. Generación de Valor Práctico
Proporcionar evidencias para la toma de decisiones en políticas públicas

Identificar puntos críticos donde la movilidad genera problemas de sostenibilidad

Sugerir áreas prioritarias para inversión en infraestructuras de transporte

4. Contribución al Conocimiento
Actualizar el entendimiento de los patrones de movilidad post-pandemia

Establecer metodologías replicables para el análisis de datos de commuting

Documentar lecciones aprendidas sobre la integración de datasets europeos

Este trabajo busca transformar datos brutos en conocimiento útil, conectando el rigor técnico de la ingeniería de datos con las necesidades reales de planificación territorial y calidad de vida de los ciudadanos europeos.

# Aportaciones del trabajo

<!-- estas sección se suele escribir al final del trabajo --> 

## Principales aportaciones

<!-- Análisis del significado e implicaciones de los resultados en el contexto del área de estudio. Nuevas perspectivas o enfoques. Actualización del conocimiento existente. Debe estar alineado con los objetivos. Comentar cuadro de mandos como aportación  -->


## Alineamiento con los objetivos de desarrollo sostenible

<!-- Hay que rellenar el fichero "ODS.xlsx" con nuestros datos. Si en ChatGPT hacemos la consulta "Relacionar "mi tema de proyecto" con ODS" nos saldrá un borrador de relaciones que podremos usar como base y  perfeccionar. --> 

El estudio de cómo se desplazan las personas al trabajo en Europa nos permite entender mejor la vida cotidiana de millones de ciudadanos. Analizar los tiempos y distancias de los desplazamientos no solo refleja la organización de nuestras ciudades, sino también cómo se distribuyen las oportunidades laborales. En muchos casos, largos trayectos diarios pueden dificultar la conciliación entre la vida personal y profesional, mostrando que no todos tienen las mismas facilidades para acceder a un empleo cercano. Este aspecto se relaciona directamente con el ODS 8, Trabajo decente y crecimiento económico, porque los desplazamientos influyen en la calidad y el acceso al empleo.

Además, la manera en que nos movemos tiene un impacto directo en nuestro entorno y en el clima. Elegir caminar, usar la bicicleta o el transporte público en lugar del coche no solo ahorra tiempo y dinero, sino que también ayuda a reducir la contaminación y a hacer que las ciudades sean más agradables para vivir. Analizar estos patrones de commuting contribuye al ODS 13, Acción por el clima, al proporcionar información para reducir emisiones y fomentar una movilidad más sostenible. Al mismo tiempo, permite identificar áreas donde la infraestructura de transporte necesita mejoras, apoyando el ODS 9, Industria, innovación e infraestructura, ya que planificar mejor las redes de transporte puede hacer que los desplazamientos sean más eficientes, seguros e inclusivos.

Este análisis también ayuda a revelar desigualdades invisibles. Por ejemplo, algunas zonas de Europa ofrecen muchas oportunidades de empleo cerca del hogar, mientras que otras obligan a largas horas de viaje. Esto afecta de manera diferente a hombres y mujeres, y puede influir en la manera en que las familias organizan su día a día. Conocer estas diferencias está relacionado con el ODS 5, Igualdad de género, porque permite pensar en soluciones que hagan la movilidad más justa para todos.

```{r}
tb <- read.xlsx("ODS.xlsx") %>%
  as_tibble()
tb[is.na(tb)] <- ""

colnames(tb) <- c("ODS","No procede", "Bajo", "Medio","Alto")
tabla <- kable(tb,caption="Grado de relación del proyecto con los objetivos de desarrollo sostenible (ODS)", 
                format = "html",
                table.attr = 'style="width:500px; margin-left: auto; margin-right: auto;"') 
tabla %>% column_spec(2, extra_css = "text-align: center;") %>%
          column_spec(3, extra_css = "text-align: center;") %>%
          column_spec(4, extra_css = "text-align: center;") %>%
          column_spec(5, extra_css = "text-align: center;")
```


# Desarrollo


## Herramientas empleadas

<!-- mencionar y justificar para este trabajo el uso de R, RStudio y las librerías principales utilizadas. Mencionar también el servidor shiny del DIS para desplegar públicamente el cuadro de mandos    --> 
Para el análisis se ha utilizado R junto con RStudio, que proporcionan un entorno flexible para el manejo de datos, análisis estadístico y visualización. Se han utilizado diversas librerías que permiten abordar distintos aspectos del proyecto: eurostat para acceder y procesar datos estadísticos europeos; openxlsx para la lectura y escritura de archivos Excel; DT para la visualización interactiva de tablas; leaflet y geojsonio para la elaboración de mapas interactivos; tidyverse y ggplot2 para la manipulación de datos y creación de gráficos; urca para análisis econométricos; GGally y pxR para exploración y visualización de relaciones entre variables; y fpp3 para análisis de series temporales. El cuadro de mandos resultante se ha desplegado públicamente mediante el servidor Shiny del DIS de la ULPGC, garantizando accesibilidad remota y difusión eficiente de los resultados.

## Metodología

Utilizaremos la metodología de desarrollo CRISP-DM (Cross Industry Standard Process for Data Mining) que es un marco ampliamente utilizado para proyectos de Ciencias de Datos. En la siguiente figura se presenta un diagrama con las diferentes fases de esta metodología que a continuación describimos con más detalle: 

<center>
<img src="https://ctim.es/AEDV/1200px-CRISP-DM_Process_Diagram1.5x.png" width="40%" />
<p style="font-size: 14px; color: gray;"><em>Diagrama metodología de desarrollo CRISP-DM</em></p>
</center>



* **Comprensión del negocio**. Se plantean los objetivos del proyecto y la búsqueda de información y datos. 

<!-- Una parte de esta fase incluye la descripción del objeto del proyecto y sus objetivos, como eso ya se ha presentado anteriormente en la memoria no se repite aquí. Otra parte que si se incluye es describir lo que se ha hecho para  la búsqueda de datos, las fuentes consultadas, entrevistas, lecturas bibliográficas, etc.. señalando las incidencias/dificultades encontradas, así como el análisis de la fiabilidad de la información obtenida. En esta fase no se realiza una descripción detallada de los datos ni pondremos gráficas.  -->

* **Comprensión de los datos**. Se analiza la  estructura y organización de los datos obtenidos. Se identifican posible problemas como datos faltantes, outliers o inconsistencias. 

<!-- Identificar y describir con claridad el significado de las variables categóricas existentes (y todos los valores que pueden tomar) y las observaciones (habitualmente valores numéricos). Identificar si los datos están organizados de forma ordenada (tidy), es decir una sola observación por cada fila de la tabla acompañada de variables categóricas o de forma no ordenada, es decir, varias observaciones por cada fila. En este caso,  habitualmente, los valores posibles de una variable categórica se distribuyen como títulos de columnas de la tabla y cada celda de esas columnas incluye una observación. Estudiar la frecuencia (Nº de observaciones) asociadas a las variables categóricas, el tamaño e intervalo temporal de las series temporales (si procede), la distribución del nº de observaciones por regiones, o por otro tipo de desglose de la información (si procede), análisis de los atributos combinados existentes, dados por las combinaciones de variables categóricas que aparecen en el dataset. Analizar en más detalle (si hubiera lugar) como son los datos en la regiones que más me interesan. Identificación de errores, valores ausentes, outliers o cualquier otra incosistencia encontrada. 

En esta fase no se realiza procesado de datos salvo el mínimo para obtener la información que se requiere. Tampoco se entra a valorar la calidad de los datos o como habría que procesarlos. En términos médicos, esta sería la fase del diagnóstico donde todavía no se comenta nada del pronóstico del paciente o del tratamiento. Por tanto no se expresan opiniones sobre los datos, solo se exponen tal cual son. 

En esta fase, en general, no pondremos gráficos, salvo cosas muy sencillas relativas a las frecuencias de los datos y cosas de ese tipo, pues los gráficos requieren, en general, selección y procesamiento de datos previo. 

El análisis de lo datos realizado para la validación del tema del proyecto personal va en este apartado. 

--> 

```{r,echo=FALSE}
# CÓDIGO DATASET
dataset1.name <- "lfst_r_lfe2ecomm"
dataset2.name <- "lfst_r_lfe2eedu"
```

```{r,echo=FALSE}
# OPCIONES POR DEFECTO AL COMPILAR LOS CHUNKS 
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo=FALSE,
  cache=TRUE
)
```

```{r, echo=FALSE}
library(eurostat)
library(openxlsx)
library(DT)
library(leaflet)  
library(geojsonio) 
library(tidyverse)
library(ggplot2)
library(urca)
library(GGally)
library(pxR)
library(fpp3)
library(tidyverse)
```

```{r,echo=FALSE}
# asociamos funciones a determinadas librerías para evitar posibles errores 
select <- dplyr::select
mutate <- dplyr::mutate
filter <- dplyr::filter
group_by <- dplyr::group_by
summarise <- dplyr::summarise
selectInput <- shiny::selectInput
```

```{r}
# CÓDIGOS NUTS DE REGIONES REALES PRESENTES EN LOS MAPAS NUTS ACTUALES

NUTS0_codes <- c("EL", "ES", "FI", "FR", "HR", "HU", "IE", "IS", "AL", "AT", "BA", "BE", "BG", "CH", "CY", "CZ", "DE", "DK", "EE", "IT", "LI", "LT", "LU", "LV", "ME", "MK", "MT", "NL", "NO", "PL", "PT", "RO", "RS", "SE", "SI", "SK", "TR", "UA", "XK")

NUTS1_codes <- c("DEA", "DEB", "DEC", "DED", "DEE", "DEF", "DEG", "DK0", "EE0", "EL3", "EL4", "EL5", "EL6", "ES1", "ES2", "ES3", "ES4", "ES5", "ES6", "ES7", "FI1", "AL0", "AT1", "AT2", "AT3", "BA0", "BE1", "BE2", "BE3", "BG3", "BG4", "CH0", "CY0", "CZ0", "DE1", "DE2", "DE3", "DE4", "DE5", "DE6", "DE7", "DE8", "DE9", "HR0", "HU1", "HU2", "HU3", "IE0", "IS0", "ITC", "ITF", "ITG", "ITH", "ITI", "LI0", "XK0", "LT0", "LU0", "LV0", "ME0", "MK0", "MT0", "NL1", "NL2", "NL3", "NL4", "NO0", "PL2", "PL4", "PL5", "PL6", "PL7", "PL8", "PL9", "PT1", "PT2", "PT3", "RO1", "RO2", "RO3", "RO4", "RS1", "RS2", "SE1", "SE2", "SE3", "SI0", "SK0", "TR1", "TR2", "TR3", "TR4", "TR5", "TR6", "TR7", "TR8", "TR9", "TRA", "TRB", "TRC", "FI2", "FR1", "FRB", "FRC", "FRD", "FRE", "FRF", "FRG", "FRH", "FRI", "FRJ", "FRK", "FRL", "FRM", "FRY")

NUTS2_codes <- c("DE12", "DE13", "DE14", "DE21", "DE22", "DE23", "DE24", "DE25", "DE26", "DE27", "DE30", "DE40", "DE50", "DE60", "DE71", "DE72", "DE73", "DE80", "DE91", "DE92", "DE93", "DE94", "DEA1", "DEA2", "DEA3", "DEA4", "DEA5", "DEB1", "DEB2", "DEB3", "DEC0", "DED2", "DED4", "DED5", "DEE0", "DEF0", "DEG0", "DK01", "AL01", "AL02", "AL03", "AT11", "AT12", "AT13", "AT21", "AT22", "AT31", "AT32", "AT33", "AT34", "BA01", "BA02", "BA03", "BE10", "BE21","BE22", "BE23", "BE24", "BE25", "BE31", "BE32", "BE33", "BE34", "BE35", "BG31", "BG32", "BG33", "BG34", "BG41", "BG42", "CH01", "CH02", "CH03", "CH04", "CH05", "CH06", "CH07", "CY00", "CZ01", "CZ02", "CZ03", "CZ04", "CZ05", "CZ06", "CZ07", "CZ08", "DE11", "MK00", "MT00", "NL11", "NL12", "NL13", "NL21", "NL22", "NL23", "NL32", "NL34", "NL35", "NL36", "NL41", "NL42", "NO02", "NO06", "NO07", "NO08", "NO09", "NO0A", "NO0B", "PL21", "PL22", "PL41", "PL42", "PL43", "PL51", "PL52", "PL61", "PL62", "PL63", "PL71", "PL72", "PL81", "PL82", "PL84", "PL91", "PL92", "PT11", "PT15", "PT19", "PT1A", "PT1B", "PT1C", "DK02", "DK03", "DK04", "DK05", "EE00", "EL30", "EL41", "EL42", "EL43", "EL51", "EL52", "EL53", "EL54", "EL61", "EL62", "EL63", "EL64", "EL65", "ES11", "ES12", "ES13", "ES21", "ES22", "ES23", "ES24", "ES30", "ES41", "ES42", "ES43", "ES51", "ES52", "ES53", "ES61", "ES62", "ES63", "ES64", "ES70", "FI19", "FI1B", "FI1C", "FI1D", "FI20", "FR10", "FRB0", "FRC1", "FRC2", "FRD1", "FRD2", "FRE1", "FRE2", "FRF1", "FRF2", "FRF3", "FRG0", "FRH0", "FRI1", "FRI2", "FRI3", "FRJ1", "FRJ2", "FRK1", "FRK2", "FRL0", "FRM0", "FRY1", "FRY2", "FRY3", "FRY4", "FRY5", "HR02", "HR03", "HR05", "HR06", "HU11", "HU12", "HU21", "HU22", "HU23", "HU31", "HU32", "HU33", "IE04", "IE05", "IE06", "IS00", "ITC1", "ITC2", "ITC3", "ITC4", "ITF1", "ITF2", "ITF3", "ITF4", "ITF5", "ITF6", "ITG1", "ITG2", "ITH1", "ITH2", "ITH3", "ITH4", "ITH5", "ITI1", "ITI2", "ITI3", "ITI4", "LI00", "LT01", "LT02", "LU00", "LV00", "ME00", "SE33", "SI03", "SI04", "SK01", "SK02", "SK03", "SK04", "TR10", "TR21", "TR22", "TR31", "TR32", "TR33", "TR41", "TR42", "TR51", "TR52", "TR61", "TR62", "TR63", "TR71", "TR72", "TR81", "TR82", "TR83", "TR90", "TRA1", "TRA2", "TRB1", "TRB2", "TRC1", "TRC2", "TRC3", "XK00", "PT1D", "PT20", "PT30", "RO11", "RO12", "RO21", "RO22", "RO31", "RO32", "RO41", "RO42", "RS11", "RS12", "RS21", "RS22", "SE11", "SE12", "SE21", "SE22", "SE23", "SE31", "SE32")

NUTS3_codes <- c("AT333", "AT334", "AT335", "AT341", "AT342", "BE100", "BE211", "BE212", "BE213", "BE223", "BE224", "BE225", "BE231", "BE232", "BE233", "BE234", "BE235", "BE236", "BE241", "BE242", "BE251", "BE252", "BE253", "BE254", "BE255", "BE256", "BE257", "BE258", "BE310", "BE323", "BE328","BE329", "BE32A", "BE32B", "BE32C", "BE32D", "BE331", "BE332", "BE334", "BE335", "BE336", "BE341", "BE342", "BE343", "BE344", "BE345", "BE351", "BE352", "BE353", "BG311", "BG312", "BG313", "BG314", "BG315", "BG321", "BG322", "BG323", "BG324", "BG325", "BG331", "BG332", "BG333", "BG334", "BG341", "BG342", "BG343", "BG344", "BG411", "BG412", "BG413", "BG414", "BG415", "BG421", "BG422", "BG423", "BG424", "BG425", "CH011", "CH012", "CH013", "CH021", "CH022", "CH023", "CH024", "CH025", "CH031", "CH032", "CH033", "CH040", "CH051", "CH052", "CH053", "CH054", "CH055", "CH056", "CH057", "CH061", "CH062", "CH063", "CH064", "CH065", "CH066", "CH070", "CY000", "CZ010", "CZ020", "CZ031", "CZ032", "CZ041", "CZ042", "CZ051", "CZ052", "CZ053", "CZ063", "CZ064", "CZ071", "CZ072", "CZ080", "DE111", "DE112", "DE113", "DE114", "DE115", "DE116", "DE117", "DE118", "DE119", "DE11A", "DE11B", "DE11C", "DE11D", "DE121", "DE122", "DE123", "DE124", "DE125", "DE126", "DE127", "DE128", "DE129", "DE12A", "DE12B", "DE12C", "DE131", "DE132", "DE133", "DE134", "DE135", "DE136", "DE137", "DE138", "DE139", "DE13A", "DE141", "DE142", "DE143", "DE144", "DE145", "DE146", "DE147", "DE148", "DE149", "DE211", "DE212", "AL011", "AL012", "AL013", "AL014", "AL015", "AL021", "AL022", "AL031", "AL032", "AL033", "AL034", "AL035", "AT111", "AT112", "AT113", "AT121", "AT122", "AT123", "AT124", "AT125", "AT126", "AT127", "AT130", "AT211", "AT212", "AT213", "AT221", "AT222", "AT223", "AT224", "AT225", "AT226", "AT311", "AT312", "AT313", "AT314", "AT315", "AT321", "AT322", "AT323", "AT331", "AT332", "DE238", "DE239")

NUTS3_codes <-c(NUTS3_codes, "DE23A", "DE241", "DE242", "DE243", "DE244", "DE245", "DE246", "DE247", "DE248", "DE249", "DE24A", "DE24B", "DE24C", "DE24D", "DE251", "DE252", "DE253", "DE254", "DE255", "DE256", "DE257", "DE258", "DE259", "DE25A", "DE25B", "DE25C", "DE261", "DE262", "DE263", "DE264", "DE265", "DE266", "DE267", "DE268", "DE269", "DE26A", "DE26B", "DEA5C", "DEB11", "DEB12", "DEB13", "DEB14", "DEB15", "DEB17", "DEB18", "DEB1A", "DEB1B", "DEB1C", "DEB1D", "DEB21", "DEB22", "DEB23", "DEB24", "DEB25", "DEB31", "DEB32", "DEB33", "DEB34", "DEB35", "DEB36", "DEB37", "DEB38", "DEB39", "DEB3A", "DEB3B", "DEB3C", "DEB3D", "DEB3E", "DEB3F", "DEB3G", "DEB3H", "DEB3I", "DEB3J", "DEB3K", "DEC01", "DEC02", "DEC03", "DEC04", "DEC05", "DEC06", "DED21", "DED2C", "DED2D", "DED2E", "DED2F", "DED41", "DED42", "DED43", "DED44", "DED45", "DED51", "DED52", "DED53", "DEE01", "DEE02", "DEE03", "DEE04", "DEE05", "DEE06", "DEE07", "DEE08", "DEE09", "DEE0A", "DEE0B", "DEE0C", "DEE0D", "DEE0E", "DEF01", "DEF02", "DEF03", "DEF04", "DEF05", "DEF06", "DEF07", "DEF08", "DEF09", "DEF0A", "DEF0B", "DEF0C", "DEF0D", "DEF0E", "DEF0F", "DEG01", "DEG02", "DE26C", "DE271", "DE272", "DE273", "DE274", "DE275", "DE276", "DE277", "DE278", "DE279", "DE27A", "DE27B", "DE27C", "DE27D", "DE27E", "DE300", "DE401", "DE402", "DE403", "DE404", "DE405", "DE406", "DE407", "DE408", "DE409", "DE40A", "DE40B", "DE40C", "DE40D", "DE40E", "DE40F", "DE40G", "DE40H", "DE40I", "DE501", "DE502", "DE600", "DE711", "DE712", "DE713", "DE714", "DE715", "DE716", "DE717", "DE718", "DE719", "DE71A", "DE71B", "DE71C", "DE71D", "DE71E", "DE721", "DE722", "DE723", "DE724", "DE725", "DE731", "DE732", "DE733", "DE734", "DE735", "DE736", "DE737", "DE803", "DE804", "DE80J", "DE80K", "DE80L", "DE80M", "DE80N", "DE80O", "DE911", "DE912", "DE913", "DE914", "DE916", "DE917", "DE918", "DE91A", "DE91B", "DE91C", "DE922", "DE923", "DE925", "DE926", "DE927", "DE928", "DE929", "DE931", "DE932", "DE933", "DE934", "DE935", "DE936", "DE937", "DE938", "DE939", "DE93A", "DE93B", "DE941", "DE942", "DE943", "DE944", "DE945", "DE946", "DE947", "DE948", "DE949", "DE94A", "DE94B", "DE94C", "DE94D")

NUTS3_codes <-c(NUTS3_codes, "DE94E", "DE94F", "DE94G", "DE94H", "DEA11", "DEA12", "DEA13", "DEA14", "DEA15", "DEA16", "DEA17", "DEA18", "DEA19", "DEA1A", "DEA1B", "DEA1C", "DEA1D", "DEA1E", "DEA1F", "DEA22", "DEA23", "DEA24", "DEA26", "DEA27", "DEA28", "DEA29", "DEA2A", "DEA2B", "DEA2C", "DEA2D", "DEA31", "DEA32", "DEA33", "DEA34", "DEA35", "DEA36", "DEA37", "DEA38", "DEA41", "DEA42", "DEA43", "DEA44", "DEA45", "DEA46", "DEA47", "DEA51", "DEA52", "DEA53", "DEA54", "DEA55", "DEA56", "DEA57", "DEA58", "DEA59", "DEA5A", "DEA5B", "DE213", "DE214", "DE215", "DE216", "DE217", "DE218", "DE219", "DE21A", "DE21B", "DE21C", "DE21D", "DE21E", "DE21F", "DE21G", "DE21H", "DE21I", "DE21J", "DE21K", "DE21L", "DE21M", "DE21N", "DE221", "DE222", "DE223", "DE224", "DE225", "DE226", "DE227", "DE228", "DE229", "DE22A", "DE22B", "DE22C", "DE231", "DE232", "DE233", "DE234", "DE235", "DE236", "DE237", "FRD11", "FRD12", "FRD13", "FRD21", "FRD22", "FRE11", "FRE12", "FRE21", "FRE22", "FRE23", "FRF11", "FRF12", "FRF21", "FRF22", "FRF23", "FRF24", "FRF31", "FRF32", "FRF33", "FRF34", "FRG01", "FRG02", "FRG03", "FRG04", "FRG05", "FRH01", "FRH02", "FRH03", "FRH04", "FRI11", "FRI12", "FRI13", "FRI14", "FRI15", "FRI21", "FRI22", "FRI23", "FRI31", "FRI32", "FRI33", "FRI34", "FRJ11", "FRJ12", "FRJ13", "FRJ14", "FRJ15", "FRJ21", "FRJ22", "FRJ23", "FRJ24", "FRJ25", "FRJ26", "FRJ27", "FRJ28", "FRK11", "FRK12", "FRK13", "FRK14", "FRK21", "FRK22", "FRK23", "FRK24", "FRK25", "FRK26", "FRK27", "FRK28", "FRL01", "FRL02", "FRL03", "FRL04", "FRL05", "FRL06", "FRM01", "FRM02", "FRY10", "FRY20", "DEG03", "DEG05", "DEG06", "DEG07", "DEG09", "DEG0A", "DEG0C", "DEG0D", "DEG0E", "DEG0G", "DEG0J", "DEG0K", "DEG0L", "DEG0M", "DEG0Q", "DEG0R", "DEG0S", "DEG0T", "DEG0U", "DEG0V", "DK011", "DK012", "DK013", "DK014", "DK021", "DK022", "DK031", "DK032", "DK041", "DK042", "DK050", "EE001", "EE004", "EE008", "EE009", "EE00A", "EL301", "EL302", "EL303", "EL304", "EL305", "EL306", "EL307", "EL411", "EL412", "EL413", "EL421", "EL422", "EL431", "EL432", "EL433", "EL434", "EL511", "EL512", "EL513", "EL514", "EL515", "EL521", "EL522", "EL523", "EL524", "EL525", "EL526", "EL527")

NUTS3_codes <-c(NUTS3_codes, "EL531", "EL532", "EL533", "EL541", "EL542", "EL543", "EL611", "EL612", "EL613", "EL621", "EL622", "EL623", "EL624", "EL631", "EL632", "EL633", "EL641", "EL642", "EL643", "EL644", "EL645", "EL651", "EL652", "EL653", "ES111", "ES112", "ES113", "ES114", "ES120", "ES130", "ES211", "ES212", "ES213", "ES220", "ES230", "ES241", "ES242", "ES243", "ES300", "ES411", "ES412", "ES413", "ES414", "ES415", "ES416", "ES417", "ES418", "ES419", "ES421", "ES422", "ES423", "ES424", "ES425", "ES431", "ES432", "ES511", "ES512", "ES513", "ES514", "ES521", "ES522", "ES523", "ES531", "ES532", "ES533", "ES611", "ES612", "ES613", "ES614", "ES615", "ES616", "ES617", "ES618", "ES620", "ES630", "ES640", "ES703", "ES704", "ES705", "ES706", "ES707", "ES708", "ES709", "FI196", "FI198", "FI199", "FI19A", "FI19B", "FI1B1", "FI1C1", "FI1C2", "FI1C5", "FI1C6", "FI1C7", "FI1D5", "FI1D7", "FI1D8", "FI1D9", "FI1DA", "FI1DB", "FI1DC", "FI200", "FR101", "FR102", "FR103", "FR104", "FR105", "FR106", "FR107", "FR108", "FRB01", "FRB02", "FRB03", "FRB04", "FRB05", "FRB06", "FRC11", "FRC12", "FRC13", "FRC14", "FRC21", "FRC22", "FRC23", "FRC24", "HU313", "HU321", "HU322", "HU323", "HU331", "HU332", "HU333", "IE041", "IE042", "IE051", "IE052", "IE053", "IE061", "IE062", "IE063", "IS001", "IS002", "ITC11", "ITC12", "ITC13", "ITC14", "ITC15", "ITC16", "ITC17", "ITC18", "ITC20", "ITC31", "ITC32", "ITC33", "ITC34", "ITC41", "ITC42", "ITC43", "ITC44", "ITC46", "ITC47", "ITC48", "ITC49", "NL415", "NL416", "NL421", "NL422", "NL423", "NO020", "NO060", "NO071", "NO072", "NO073", "NO081", "NO083", "NO084", "NO085", "NO092", "NO093", "NO094", "NO0A1", "NO0A2", "NO0A3", "NO0B1", "NO0B2", "PL213", "PL214", "PL217", "PL218", "PL219", "PL21A", "PL224", "PL225", "PL227", "PL228", "PL229", "PL22A", "PL22B", "PL22C", "PL411", "PL414", "PL415", "PL416", "PL417", "PL418", "PL424", "PL426", "PL427", "PL428", "PL431", "PL432", "PL514", "PL515", "PL516", "PL517", "PL518", "PL523", "PL524", "PL613", "PL616", "PL617", "PL618", "PL619", "PL621", "PL622", "PL623", "PL633", "PL634", "PL636", "PL637", "PL638", "PL711", "PL712", "ITC4A", "ITC4B", "ITC4C", "ITC4D")

NUTS3_codes <-c(NUTS3_codes, "ITF11", "ITF12", "ITF13", "ITF14", "ITF21", "ITF22", "ITF31", "ITF32", "ITF33", "ITF34", "ITF35", "ITF43", "ITF44", "ITF45", "ITF46", "ITF47", "ITF48", "ITF51", "ITF52", "ITF61", "ITF62", "ITF63", "ITF64", "ITF65", "ITG11", "ITG12", "ITG13", "ITG14", "ITG15", "ITG16", "ITG17", "ITG18", "ITG19", "ITG2D", "ITG2E", "ITG2F", "ITG2G", "ITG2H", "ITH10", "ITH20", "ITH31", "ITH32", "ITH33", "ITH34", "ITH35", "ITH36", "ITH37", "ITH41", "ITH42", "ITH43", "ITH44", "ITH51", "ITH52", "ITH53", "ITH54", "ITH55", "ITH56", "ITH57", "ITH58", "ITH59", "ITI11", "ITI12", "ITI13", "ITI14", "ITI15", "ITI16", "ITI17", "ITI18", "ITI19", "ITI1A", "ITI21", "ITI22", "ITI31", "ITI32", "ITI33", "ITI34", "ITI35", "ITI41", "ITI42", "ITI43", "ITI44", "ITI45", "LI000", "LT011", "LT021", "LT022", "LT023", "LT024", "LT025", "LT026", "LT027", "LT028", "LT029", "LU000", "LV005", "LV009", "LV00A", "LV00B", "LV00C", "ME000", "MK001", "MK002", "MK003", "MK004", "MK005", "MK006", "MK007", "MK008", "MT001", "MT002", "NL112", "NL114", "NL115", "NL126", "NL127", "NL128", "NL131", "NL132", "NL133", "NL211", "NL212", "NL213", "NL221", "NL224", "NL225", "NL226", "NL230", "NL321", "NL323", "NL325", "NL327", "NL328", "NL32A", "NL32B", "NL341", "NL342", "NL350", "NL361", "NL362", "NL363", "NL364", "NL365", "NL366", "NL411", "NL414", "FRY30", "FRY40", "FRY50", "HR021", "HR022", "HR023", "HR024", "HR025", "HR026", "HR027", "HR028", "HR031", "HR032", "HR033", "HR034", "HR035", "HR036", "HR037", "HR050", "HR061", "HR062", "HR063", "HR064", "HR065", "HU110", "HU120", "HU211", "HU212", "HU213", "HU221", "HU222", "HU223", "HU231", "HU232", "HU233", "HU311", "HU312", "TR412", "TR413", "TR421", "TR422", "TR423", "TR424", "TR425", "TR510", "TR521", "TR522", "TR611", "TR612", "TR613", "TR621", "TR622", "TR631", "TR632", "TR633", "TR711", "TR712", "TR713", "TR714", "TR715", "TR721")

NUTS3_codes <-c(NUTS3_codes, "TR722", "TR723", "TR811", "TR812", "TR813", "TR821", "TR822", "TR823", "TR831", "TR832", "TR833", "TR834", "TR901", "TR902", "TR903", "TR904", "TR905", "TR906", "TRA11", "TRA12", "TRA13", "TRA21", "TRA22", "TRA23", "TRA24", "TRB11", "TRB12", "TRB13", "TRB14", "TRB21", "TRB22", "TRB23", "TRB24", "TRC11", "TRC12", "TRC13", "TRC21", "TRC22", "TRC31", "TRC32", "TRC33", "TRC34", "PL713", "PL714", "PL715", "PL721", "PL722", "PL811", "PL812", "PL814", "PL815", "PL821", "PL822", "PL823", "PL824", "PL841", "PL842", "PL843", "PL911", "PL912", "PL913", "PL921", "PL922", "PL923", "PL924", "PL925", "PL926", "PT111", "PT112", "PT119", "PT11A", "PT11B", "PT11C", "PT11D", "PT11E", "PT150", "PT191", "PT192", "PT193", "PT194", "PT195", "PT196", "PT1A0", "PT1B0", "PT1C1", "PT1C2", "PT1C3", "PT1C4", "PT1D1", "PT1D2", "PT1D3", "PT200", "PT300", "RO111", "RO112", "RO113", "RO114", "RO115", "RO116", "RO121", "RO122", "RO123", "RO124", "RO125", "RO126", "RO211", "RO212", "RO213", "RO214", "RO215", "RO216", "RO221", "RO222", "RO223", "RO224", "RO225", "RO226", "RO311", "RO312", "RO313", "RO314", "RO315", "RO316", "RO317", "RO321", "RO322", "RO411", "RO412", "RO413", "RO414", "RO415", "RO421", "RO422", "RO423", "RO424", "RS110", "RS121", "RS122", "RS123", "RS124", "RS125", "RS126", "RS127", "RS211", "RS212", "RS213", "RS214", "RS215", "RS216", "RS217", "RS218", "RS221", "RS222", "RS223", "RS224", "RS225", "RS226", "RS227", "RS228", "RS229", "SE110", "SE121", "SE122", "SE123", "SE124", "SE125", "SE211", "SE212", "SE213", "SE214", "SE221", "SE224", "SE231", "SE232", "SE311", "SE312", "SE313", "SE321", "SE322", "SE331", "SE332", "SI031", "SI032", "SI033", "SI034", "SI035", "SI036", "SI037", "SI038", "SI041", "SI042", "SI043", "SI044", "SK010", "SK021", "SK022", "SK023", "SK031", "SK032", "SK041", "SK042", "TR100", "TR211", "TR212", "TR213", "TR221", "TR222", "TR310", "TR321", "TR322", "TR323", "TR331", "TR332", "TR333", "TR334", "TR411", "XK001", "XK002", "XK003", "XK004", "XK005", "XK006", "XK007")

NUTS.computation <- function(s){
  if(substr(s,1,2) %in% c("EU","EA","EF","CC","OE","G2","G7"))  return(s)
  if(nchar(s)==2 & s %in% NUTS0_codes) return("0")
  if(nchar(s)==3 & s %in% NUTS1_codes) return("1")
  if(nchar(s)==4 & s %in% NUTS2_codes) return("2")
  if(nchar(s)==5 & s %in% NUTS3_codes) return("3")
  return("OTHERS")
}
```

```{r}
pais_map <- c(
  # Unión Europea
  AT = "Austria", BE = "Bélgica", BG = "Bulgaria", HR = "Croacia", CY = "Chipre",
  CZ = "Chequia", DK = "Dinamarca", EE = "Estonia", FI = "Finlandia", FR = "Francia",
  DE = "Alemania", EL = "Grecia", HU = "Hungría", IE = "Irlanda", IT = "Italia",
  LV = "Letonia", LT = "Lituania", LU = "Luxemburgo", MT = "Malta", NL = "Países Bajos",
  PL = "Polonia", PT = "Portugal", RO = "Rumanía", SK = "Eslovaquia", SI = "Eslovenia",
  ES = "España", SE = "Suecia",

  # Países de la AELC (EFTA)
  IS = "Islandia", LI = "Liechtenstein", NO = "Noruega", CH = "Suiza",

  # Reino Unido (ya no UE, pero aún presente en datasets)
  UK = "Reino Unido", GB = "Reino Unido",

  # Otros países europeos frecuentes en Eurostat o ampliaciones
  AL = "Albania", BA = "Bosnia y Herzegovina", ME = "Montenegro", MK = "Macedonia del Norte",
  RS = "Serbia", TR = "Turquía", XK = "Kosovo"
)
```

```{r,results='hide'}
# cargamos las tablas y la ordenamos por fechas y países 
data <- get_eurostat(dataset1.name, time_format = "date") %>%
  as_tibble() %>%
  arrange(TIME_PERIOD,geo)
data
```

Al confeccionar este documento he tenido en cuenta: 

* He verificado que ningún alumno ha elegido, antes que yo, este tema (o uno muy similar) y he puesto los datos del dataset en la WIKI con el listado de temas elegidos por los alumnos. 

* He redactado con claridad el resumen y utilidad del dataset y he descrito con claridad el significado de las variables categóricas que aparecen y sus posibles opciones.

* Hay un número mínimo de regiones NUTS (25 para NUTS0, 90 para NUTS1, 200 para NUTS2 o 500 para NUTS3).

* El tamaño de las series temporales cumple apróximadamente que  `p50`>10.

* Las observaciones de España y/o Canarias son mayores (o cercanas) al `p75` de la distribución del nº de observaciones.

* El dataset tiene al menos 5 atributos combinados con un número de observaciones cercano al máximo de ellos, teniendo en cuenta que si el dataset contiene información de sexo y grupos de edad, estos pueden también combinarse con el resto de atributos para formar atributos combinados, o bien he añadido otros datasets que aumentan el nº de atributos.

* En el análisis visual de las series temporales para España y/o Canarias  se aprecia que la mayor parte de las series abarcan un intervalo temporal similar (con más de 10 fechas) y tienen pocos datos faltantes en el medio.



### Resumen y utilidad del dataset

* **Resumen **: Ofrece información estadística detallada sobre la población ocupada en función de su lugar de residencia y de trabajo. Su estructura contempla variables que permiten desagregar los resultados por sexo, grupo de edad, unidad de medida, región de residencia (a nivel NUTS 2) y localización del puesto de trabajo, con categorías que distinguen entre empleo en la misma región, en otra región del país o en el extranjero. Los datos se presentan con periodicidad anual y se expresan en miles de personas, lo que facilita un análisis coherente y comparativo entre territorios.

* **Utilidad**: La utilidad principal de este dataset radica en su capacidad para analizar los patrones de movilidad laboral y los desplazamientos por motivos de trabajo dentro y fuera de los países europeos. Constituye una herramienta clave para la planificación territorial, el diseño de políticas de transporte y empleo, y la evaluación de la cohesión económica y social entre regiones. Asimismo, permite identificar dinámicas diferenciadas según sexo y edad, ofreciendo evidencia empírica que respalda la formulación de estrategias en materia de mercado laboral, movilidad transfronteriza y desarrollo regional equilibrado.

Este dataset contiene información anual relativa a personas empleadas que se desplazan de su lugar de residencia al lugar de trabajo, es decir trabajadores que hacen “commuting” (desplazamiento habitual). 
Aparte del número de personas (o magnitud del commuting), también se puede desglosar por distintos criterios: sexo (hombres / mujeres), grupo de edad, región (a nivel NUTS 2), y país donde trabajan (incluido trabajo dentro de la misma región o en otra región / país). 
La unidad de medida es típicamente “miles de personas” (THS_PER, es decir en miles) para contar cuántas personas que residen en una región viajan para trabajar. La frecuencia es anual.

### Objetivos:
Analizar la dinámica del desplazamiento laboral entre regiones (intraregional / interregional / internacional).

Comparar la magnitud del commuting por sexo, edad o región.

Ver tendencias temporales: si aumenta o disminuye el commuting en determinadas regiones.

Relacionarlo con variables como infraestructura de transporte, conectividad, densidad, o condiciones laborales.

### Limitaciones / aspectos a tener en cuenta:
No da información sobre horas de desplazamiento, costos o tiempo de viaje, solo la cantidad de personas.

Puede haber diferencias de cobertura o calidad entre países/regiones.

En regiones pequeñas con pocos datos, algunos valores pueden estar suprimidos por razones de confidencialidad o fiabilidad.

El hecho de que una persona trabaje en una región distinta no implica movilidad diaria (por ejemplo, alguien que vive en una zona fronteriza y trabaja en otro país podría conmutar semanalmente).


```{r}
str(data)
```



### Descripción variables categóricas

* **freq**: frecuencia con la que se toman las observaciones. Tiene un único valor "A", que corresponde a datos anuales.


* **TIME_PERIOD**: año de referencia de la observación estadística.


* **sex**: sexo del beneficiario. Tiene 3 valores posibles: "F" femenino, "M" masculino y "T", total. 
 

* **age**: grupo de edad del beneficiario. Tiene como valores posibles tramos de edad, se usan varias categorías como Y15-64 (personas de 15 a 64 años), Y20-64 (de 20 a 64 años) o Y_GE15 (15 años o más).


* **c-work**: región / país de trabajo — define dónde trabaja la persona en relación con su región de residencia. Algunas categorías posibles son:
  - INR: trabaja en la misma región NUTS 2.
  - OUTR: trabaja en otra región dentro del país.
  - FOR: trabaja en un país extranjero.
  - NRP: sin respuesta (“No response”).
 
* **values**: Mide cuántas personas empleadas, según los criterios anteriores, se encuentran en una de las categorías de c_work. Por ejemplo, cuántas viven en la región X, tienen entre 15-64 años, son mujeres, y trabajan fuera de su región (“otra región”) o en extranjero, etc.

* **unit**: esta variable determina lo que se está midiendo en la observación (es decir lo que significa el valor de la variable `values`). Se usa “THS_PER” que significa mil personas (“thousands of persons”).

* **geo**: Geografía / región de residencia. Es la región NUTS 2 (o equivalente) donde la persona reside, para cada país participante.



```{r}
for(col in colnames(data)){
  if(is.numeric(data[[col]])) next
  if(col=="TIME_PERIOD"){
    # print(col)
    # print(
    #   paste0("data.start: ",min(data[[col]]),
    #          ", data.end: ",max(data[[col]]),
    #          ", Number of time periods: ",length(unique(data[[col]]))
    #   )
    # )
    
    cat("\nCOLUMNA: TIME_PERIOD \n")
    print(
      data %>%
        group_by(TIME_PERIOD) %>%
        summarise(N.observ=dplyr::n())%>%
        as.matrix() %>%
        noquote()
    )
    next
  }
 if(col=="geo"){
    cat("\nCONTABILIZACIÓN Nº REGIONES NUTS A PARTIR DE LA COLUMNA geo\n")
    print(
      tibble(
        NUTS=sapply(unique(data[[col]]),NUTS.computation)
      ) %>%
        group_by(NUTS) %>%
        summarise(`Number of Regions`=dplyr::n()) %>%
        as.matrix() %>%
        noquote()
    )
    next
 }
  tb <-  data %>%
    left_join(get_eurostat_dic(col)%>%rename(!!col := code_name),
              by=col) %>%
    group_by(!!sym(col),full_name)%>%
    summarise(N.Observ=dplyr::n()) %>%
    relocate(N.Observ,.before = full_name)%>%
    arrange(desc(N.Observ)) %>%
    mutate(full_name=ifelse(nchar(full_name)<41,full_name,paste0(substr(full_name,1,40),"..")))
    
  texto <- paste0("COLUMNA: ",col)
  if(nrow(tb)>50){
    texto <- paste0(texto," (",nrow(tb)," opciones, se imprimen 50)")
    tb <- head(tb,50)
  }
  cat(texto,"\n")
  
  tb %>% 
    as.matrix() %>%
    noquote() %>%
    print()
}
```

### Percentiles de la distribución de tamaños de las series temporales

Observamos que el máximo tamaño de las series temporales es 5 y además menos del 10% tienen ese tamaño. 

```{r}
vars <- colnames(data)[1:(ncol(data)-2)]

data.series <- data %>%
  group_by(across(all_of(vars))) 

data.series.fechas <- data.series %>% 
  summarise(N.fechas=dplyr::n())
```

```{r}
percentiles <- tibble(min=min(data.series.fechas$N.fechas))
percentiles <- percentiles %>% mutate(min=min(data.series.fechas$N.fechas))
percentiles <- percentiles %>% mutate(p10=quantile(data.series.fechas$N.fechas, 0.1))
percentiles <- percentiles %>% mutate(p25=quantile(data.series.fechas$N.fechas, 0.25))
percentiles <- percentiles %>% mutate(p50=quantile(data.series.fechas$N.fechas, 0.50))
percentiles <- percentiles %>% mutate(p75=quantile(data.series.fechas$N.fechas, 0.75))
percentiles <- percentiles %>% mutate(p90=quantile(data.series.fechas$N.fechas, 0.9))
percentiles <- percentiles %>% mutate(max=max(data.series.fechas$N.fechas))

percentiles
```

### Distribución del nº de observaciones por regiones 

Observamos que, para España, el nº de observaciones supera el `p75` de la distribución; aunque, si fueramos a hacer el estudio para regiones NUTS 2, no lo cumpliría pues para Canarias tiene 9202 observaciones (menor que `p75`)

```{r}
data.geo <- data %>%
  group_by(geo)%>%
  summarise(N.Observ=dplyr::n())
```

**Percentiles de la distribución del nº de observaciones por regiones**
```{r}
percentiles <- tibble(min=min(data.geo$N.Observ))
percentiles <- percentiles %>% mutate(min=min(data.geo$N.Observ))
percentiles <- percentiles %>% mutate(p10=quantile(data.geo$N.Observ, 0.1))
percentiles <- percentiles %>% mutate(p25=quantile(data.geo$N.Observ, 0.25))
percentiles <- percentiles %>% mutate(p50=quantile(data.geo$N.Observ, 0.50))
percentiles <- percentiles %>% mutate(p75=quantile(data.geo$N.Observ, 0.75))
percentiles <- percentiles %>% mutate(p90=quantile(data.geo$N.Observ, 0.9))
percentiles <- percentiles %>% mutate(max=max(data.geo$N.Observ))

percentiles
```


**Nº de observaciones en España/Canarias**
```{r}
LocalRegionsFullNames <- c("Spain","Canarias","Canarias","El Hierro","Fuerteventura","Gran Canaria",
  "La Gomera","La Palma","Lanzarote","Tenerife")

LocalRegionsCodes <- c("ES","ES7","ES70","ES703","ES704","ES705","ES706","ES707","ES708","ES709")

LocalRegions <- tibble(
  geo=LocalRegionsCodes,
  full_name=LocalRegionsFullNames
)

data.geo %>%
  filter(geo %in% LocalRegionsCodes) %>%
  left_join(LocalRegions,by="geo") %>%
  relocate(full_name,.after = geo)
```

### Combinaciones existentes de las variables categóricas 


```{r}
vars <- colnames(data)[1:(ncol(data)-3)]
vars <- vars[vars != "age"]
vars <- vars[vars != "sex"]

data.combinaciones <- data %>%
  group_by(across(all_of(vars))) 

data.combinaciones %>%
  summarise(N.observ=dplyr::n(),
            init.date=min(TIME_PERIOD),
            end.date=max(TIME_PERIOD)) %>%
  arrange(desc(N.observ)) %>% 
  print(n=50)
```


### Poner las fechas por columnas

```{r}
# pasamos las fechas a columnas de la tabla y añadimos algunos datos 
data.fechas <- data %>%
  pivot_wider(names_from = TIME_PERIOD,values_from = values,names_sort = FALSE) %>%
  #relocate(geo) %>% 
  left_join(get_eurostat_dic("geo"), join_by(geo==code_name)) %>%
  relocate(full_name,.after=geo)%>%
  mutate(NUTS=sapply(geo,NUTS.computation)) %>%
  relocate(NUTS)  %>%
  mutate(geo2=substr(geo,1,2)) %>% 
  left_join(get_eurostat_dic("geo")%>%rename(country=full_name),join_by(geo2==code_name)) %>%
  select(-geo2) %>% 
  rename(region=full_name) %>%
  relocate(country,.after = NUTS) %>%
  arrange(NUTS,country,geo)

#data.fechas
```

**Visualización España/Canarias (máximo 60 columnas y 1000 filas por región)**

```{r}
# visualización tabla para España y Canarias 
posRegion <- which(colnames(data.fechas) == "region")
Ncol <- ncol(data.fechas)
posSelect <- 1:Ncol 
if(Ncol>60) posSelect <- unique(c(1:posRegion,(Ncol-60):Ncol))

data.fechas %>%
  select(posSelect) %>% 
  filter(geo %in% LocalRegionsCodes) %>% 
  group_by(geo) %>%
  slice_head(n = 1000) %>%
  ungroup() %>% 
  relocate(region) %>% 
  datatable(
  extensions = 'FixedColumns',
  options = list(
    scrollX = TRUE,  
    scrollY = "400px", 
    paging = FALSE,     
    fixedColumns = list(leftColumns = 1) 
  ),
  class = "stripe hover nowrap",  
  rownames = FALSE  
)
```



### Dataset complementario

Este dataset contiene tasas de empleo (porcentajes) de la población en edad de trabajar, desagregadas por sexo, edad, nivel educativo, ciudadanía (o país de origen) y región NUTS 2. 

En otras palabras, no proporciona el número absoluto de personas, sino la proporción de la población que está empleada dentro de cada subgrupo. 

Los niveles educativos se refieren a la clasificación ISCED (por ejemplo, educación primaria, secundaria, terciaria). 

También está considerada la ciudadanía / nacionalidad / país de origen (por ejemplo, nacionales vs no nacionales) para ver diferencias en empleo según migración.


```{r}
data2 <- get_eurostat(dataset2.name, time_format = "date") %>%
  as_tibble() %>%
  arrange(TIME_PERIOD,geo)
data2
```





 
* **Preparación de los datos**. Se realiza limpieza, transformación, combinación y selección/creación de variables relevantes para el análisis

<!-- En esta fase, a partir de los resultados de la fase anterior, estudiamos la relevancia y calidad de la información obtenida en la fase anterior de acuerdo con los objetivos del proyecto, si procede seleccionamos/eliminamos variables categóricas o algunas de sus opciones, exponiendo con claridad y justificadamente los atributos combinados (formados por combinaciones de variables categóricas) que vamos a usar en el estudio. Decidimos el intervalo temporal que vamos a usar para  nuestro estudio. Realizamos la limpieza, transformación,  creación de nuevas variables, combinación de tablas,etc... En esta fase pondremos las gráficas que ilustran los datos una vez procesados y seleccionados pero sin usar los modelos que se formulan en la siguiente fase.  --> 



### Diagrama de barras de los países con mayor número de personas que han hecho commuting durante el año 2024.

```{r}
tb1 <- data %>%
  filter(geo %in% NUTS0_codes, sex=="T", age == "Y_GE15", c_work != "NPR", TIME_PERIOD == "2024-01-01") %>%
  group_by(geo) %>%
  summarise(total=sum(na.omit(values))) %>%
  ungroup() %>%
  mutate(pais= pais_map[geo]) %>% 
  filter(total>5000) %>%
  arrange(total)
tb1
```


```{r}
tb1 %>%
  mutate(pais=factor(pais,levels = unique(pais))) %>%
  ggplot(aes(x=total,y=pais,fill=geo))+
  geom_bar(stat = "identity") +
  labs(x="Valores totales",y=" ") +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")
```

### Diagrama de tarta con el número de personas que hacen commuting en Europa por sexo en el 2024.

```{r}
tb1 <- data %>%
  filter(geo %in% NUTS0_codes, sex!="T", age == "Y_GE15", c_work != "NPR", TIME_PERIOD == "2024-01-01") %>%
  group_by(sex) %>%
  summarise(total=sum(na.omit(values))) %>%
  ungroup() %>%
  arrange(total)
tb1
```

```{r}
tb1 %>%
  ggplot(aes(x="",y=total,fill=sex)) +
  geom_col() +
  geom_text(aes(x=1.,label = total),size=6, position = position_stack(vjust = 0.5)) +
  coord_polar(theta = "y") +
  theme_void(base_size = 16)+
  labs(subtitle="Personas que hacen commuting en Europa en el 2024")
```

### Diagrama según la distancia (c_work) de commuting en el 2024.

```{r}
tb1 <- data %>%
  filter(geo %in% NUTS0_codes, sex!="T", age == "Y_GE15", TIME_PERIOD == "2024-01-01") %>%
  group_by(c_work) %>%
  summarise(total=sum(na.omit(values))) %>%
  ungroup() %>%
  arrange(total)
tb1
```


```{r}
tb1$c_work <- factor(tb1$c_work,
                     levels = c("FOR", "INR", "NRP","OUTR"),
                     labels = c("Otro país", "Misma región", "No responde", "Otra región"))
tb1 %>%
  ggplot(aes(x="",y=total,fill=c_work)) +
  geom_col() +
  coord_polar(theta = "y") +
  theme_void(base_size = 14) +
  labs(subtitle="Distancia de commuting en el 2024 en Europa")
```







* **Modelado**. Selección y aplicación de los modelos adecuados para analizar los datos 

<!-- Se aplican a los datos los modelos utilizados, como por ejemplo, regresión lineal, modelos ARIMA, matriz de correlación, PCA, etc.. En esta fase se pondrán gráficas sobre el uso de de estos modelos.  --> 


### Serie temporal de commuting en España


```{r}
commuting_es <- get_eurostat(dataset1.name, time_format = "date") %>%
  as_tibble() %>% 
  mutate(TIME_PERIOD = year(TIME_PERIOD), c_work = as.character(c_work)) %>%
  filter(geo == "ES", sex == "T", age == "Y_GE15", c_work != "INR", c_work != "NRP") %>%
  group_by(TIME_PERIOD, c_work) %>%
  summarise(total = sum(values, na.rm = TRUE), .groups = "drop") %>%
  distinct(TIME_PERIOD, c_work, .keep_all = TRUE)
commuting_es$c_work <- factor(commuting_es$c_work,
                     levels = c("FOR", "INR", "NRP","OUTR"),
                     labels = c("Otro país", "Misma región", "No responde", "Otra región"))

commuting_tsibble <- commuting_es %>%
  as_tsibble(index = TIME_PERIOD, key = c_work) %>%
  fill_gaps()
commuting_tsibble
```


```{r}
commuting_tsibble %>% autoplot(size=0.7) + 
  theme_bw(base_size = 14) + 
  labs(title = "Españoles que trabajan en otro país o región",
       y = "Miles de personas",
       x = "Año")
```








### Unificamos ambas líneas para estudiar la tendencia de la serie

```{r}
commuting_es <- get_eurostat(dataset1.name, time_format = "date") %>%
  as_tibble() %>% 
  mutate(TIME_PERIOD = year(TIME_PERIOD), c_work = as.character(c_work)) %>%
  filter(geo == "ES", sex == "T", age == "Y_GE15", c_work != "INR", c_work != "NRP") %>%
  group_by(TIME_PERIOD) %>%
  summarise(total = sum(values, na.rm = TRUE), .groups = "drop")

commuting_tsibble_unido <- commuting_es %>%
  as_tsibble(index = TIME_PERIOD) %>%
  fill_gaps()

commuting_tsibble_unido %>% autoplot(size=0.7) + 
  theme_bw(base_size = 14) + 
  labs(title = "Evolución del empleo en otro país o región",
       y = "Miles de personas",
       x = "Año")
```







### Visualización estacionalidad de 12 meses





### Descomposición STL 

```{r}
ajuste <- commuting_tsibble_unido %>%
  model(STL(total, robust = TRUE))

commuting_tsibble_unido.STL <- components(ajuste)


```

```{r, fig.asp=1}
commuting_tsibble_unido.STL %>% autoplot() + 
  theme_bw(base_size = 14)
```

Se observa una clara tendencia al alza en el número de personas empleadas a larga distancia.
Ahora intentaremos predecir el comportamiento de esta variable en el futuro.


```{r}
commuting_tsibble_unido.arima <- commuting_tsibble_unido %>% model(ARIMA(total))


```

```{r}
commuting_tsibble_unido.arima.prediction <- commuting_tsibble_unido.arima %>%
  forecast(h="10 years")
```

```{r, fig.asp=0.5}
commuting_tsibble_unido.arima.prediction %>%
  autoplot(commuting_tsibble_unido) +
  labs(title = "Empleo en otro país/región en los próximos 10 años",
       x = "Año",
       y = "Miles de personas") + 
  theme_bw(base_size = 14)
```





### Interpolación de las épocas de cambios significativos en el empleo en España: crisis del 2008 y pandemia del 2020

```{r}
commuting_es.omit <- get_eurostat(dataset1.name, time_format = "date") %>%
  as_tibble() %>% 
  mutate(TIME_PERIOD = year(TIME_PERIOD), c_work = as.character(c_work)) %>%
  filter(geo == "ES", sex == "T", age == "Y_GE15", c_work != "INR", c_work != "NRP",TIME_PERIOD != 2007,TIME_PERIOD != 2006,TIME_PERIOD != 2005,TIME_PERIOD != 2008, TIME_PERIOD != 2020) %>%
  group_by(TIME_PERIOD) %>%
  summarise(total = sum(values, na.rm = TRUE), .groups = "drop")
commuting_es.omit
commuting_tsibble_unido.omit <- commuting_es.omit %>%
  as_tsibble(index = TIME_PERIOD) %>%
  fill_gaps()

commuting_tsibble_unido.omit %>% autoplot(size=0.7) + 
  theme_bw(base_size = 14) + 
  labs(title = "Evolución del empleo en otro país o región",
       y = "Miles de personas",
       x = "Año")
```

```{r}
commuting_tsibble_unido.omit.arima <- commuting_tsibble_unido.omit %>% model(ARIMA(total))


```

```{r}
commuting_tsibble_unido.omit.arima.prediction <- commuting_tsibble_unido.omit.arima %>%
  forecast(h="10 years")

```


```{r, fig.asp=0.5}
commuting_tsibble_unido.fill <- commuting_tsibble_unido.omit.arima %>% 
  interpolate(commuting_tsibble_unido.omit)

commuting_tsibble_unido.fill

commuting_tsibble_unido.fill %>% autoplot(size=0.7) +
  theme_bw(base_size=14) +
  labs(title = "Datos interpolados")
```

Una vez rellenados los huecos, volvemos a hacer la descomposición STL

```{r, fig.asp=1}
commuting_tsibble_unido.fill %>% model(STL(total, robust = TRUE)) %>%
  components() %>%
  autoplot() +
  theme_bw(base_size = 14)
```

Como podemos observar, se ha reducido significativamente el error.

```{r}
commuting_tsibble_unido.fill.arima <- commuting_tsibble_unido.fill %>% model(ARIMA(total))

```


```{r}
commuting_tsibble_unido.fill.arima.prediction <- commuting_tsibble_unido.fill.arima %>%
  forecast(h="10 years")

```

```{r, fig.asp=0.5}
commuting_tsibble_unido.fill.arima.prediction %>%
  autoplot(commuting_tsibble_unido.fill) +
  labs(title = "Datos interpolados",
       x = "Año",
       y = "Miles de personas") + 
  theme_bw(base_size = 14)
```




* **Evaluación**. Evaluar si el modelo responde a las preguntas de investigación, comparación con otros métodos 

<!-- Se discuten de forma crítica los resultados obtenidos incluyendo pruebas de evaluación / validación realizadas (si procede) --> 

* **Despliegue**. Comunicación del trabajo en una memoria y diseño y elaboración de un cuadro de mandos para presentar los resultados de forma eficaz y atractiva. 

<!-- El despliegue de este proyecto se realizará a través de la confección de esta memoria y de un cuadro de mandos. --> 

 
 <!-- De acuerdo con esta metodología, los resultados se van presentando, discutiendo y validando a lo largo de las fases de **Modelado**, **Evaluación** y **Despliegue** y, por tanto, para mantener una estructura coherente de la memoria, de acuerdo con la aplicación de la  metodología CRISP-DM, no existe en la memoria una sección separada de presentación de resultados.  --> 
 
 
 Es importante observar que esta metodología es iterativa, es decir que los resultados obtenidos en algunas de las fases puede afectar al desarrollo de fases anteriores. 
 
 A continuación se describirá en detalle como se han abordado cada una de las fases del desarrollo del proyecto siguiendo esta metodología.


## Comprensión del negocio

<!-- desarrollo de esta fase -->

## Comprensión de los datos

<!-- desarrollo de esta fase -->

## Preparación de los datos

<!-- desarrollo de esta fase -->

## Modelado

<!-- desarrollo de esta fase -->

## Evaluación

<!-- desarrollo de esta fase -->

## Despliegue

<!-- desarrollo de esta fase -->

# Conclusiones y trabajo futuro


## Conclusiones

<!-- Revisión clara y concisa de los hallazgos más relevantes del estudio, vinculados directamente con los objetivos o hipótesis planteados. Reconocimiento honesto de los puntos débiles o restricciones (por ejemplo, tamaño de muestra reducido, falta de datos, sesgos.  Evitar aquí generalidades de ChatGPT --> 

## Trabajo futuro

<!-- Líneas de trabajo futuro, aspectos pendientes, posibles extensiones. --> 


## Anexo. Seguimiento temporal actividades del proyecto  {-} 


<!-- Lo primero que hay que hacer es compartir en modo lectura la hoja de cálculo Google Sheet que habremos descargado del Campus Virtual para registrar las sesiones de trabajo. A continuación se sustituirá, debajo, el enlace que figura en la lectura del archivo (read_sheet) por el enlace compartido que has creado. 

La primera vez que abras la hoja de cálculo google sheet desde código en R, desde la consola te pedirá autorización para usar una cuenta Google. 

ES OBLIGATORIO TENER ACTUALIZADO ESTE APARTADO EN CADA ENTREGA DEL PROYECTO. 

CADA SESIÓN DE TRABAJO SE DEBE REGISTRAR EN LA GOOGLE SHEET EN EL MOMENTO DE REALIZARSE. EN PARTICULAR EN UNA ENTREGA  DEL PROYECTO NO PUEDEN APARECER SESIONES DE TRABAJOS NUEVAS CON FECHAS ANTERIORES A LA ENTREGA ANTERIOR DEL PROYECTO. 
-->

```{r}
SeguimientoActividadesProyecto <- read_sheet('https://docs.google.com/spreadsheets/d/1qjluJJHBWU-xdNkqXpOBka-BcsRXSsVmHQ75axn-BtM/edit?usp=sharing') %>%
  as_tibble() 
```

TOTAL HORAS TRABAJADAS EN EL PROYECTO : `r  round(sum(SeguimientoActividadesProyecto$MINUTES/60),digits=2)`


```{r}
actividades <- c("Introducción","Aportaciones del trabajo","Compresión del negocio","Comprensión de los datos","Preparación de los datos","Modelado","Evaluación","Despliegue","Conclusiones y Trabajo Futuro","Otros")
p <- SeguimientoActividadesProyecto%>%
  group_by(ACTIVITY)%>%
   summarise(
     HORAS=round(sum(MINUTES)/60,digits = 1)
   )%>%
  mutate(ACTIVITY=factor(ACTIVITY,levels=actividades)) %>% 
  ggplot(aes(ACTIVITY,HORAS)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=HORAS),size=3,colour = "blue",nudge_y = 0.2)+ 
  theme(axis.text.x = element_text(angle = 45,hjust=1))+
  labs(x="",y="HORAS TRABAJADAS",title = "TOTAL HORAS TRABAJADAS EN EL PROYECTO POR ACTIVIDAD")

ggplotly(p)
  
 
```




**DESGLOSE DETALLADO DE LAS SESIONES DE TRABAJO**
```{r}
SeguimientoActividadesProyecto%>% 
  datatable(
  options = list(
    scrollX = TRUE,   # Scroll horizontal
    scrollY = "400px", # Scroll vertical
    paging = FALSE     # Desactiva paginación si quieres solo scroll
  )
)
```

